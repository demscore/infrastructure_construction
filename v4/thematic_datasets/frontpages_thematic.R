library(dplyr)
library(demutils)

source_dir <- "~/proj/demscore/reference_documents/demscorecodebook/"
dest_dir <- "~/data/demscore_next_release/autogenerated_refs/static/"

files <- list(
  gender = "genderfrontpage.pdf",
  environment = "environmentfrontpage.pdf",
  parties = "partiesfrontpage.pdf",
  media = "mediafrontpage.pdf",
  migration = "migrationfrontpage.pdf",
  unemployment = "unemploymentfrontpage.pdf",
  education = "educationfrontpage.pdf",
  security = "securityfrontpage.pdf",
  corruption = "corruptionfrontpage.pdf"
)

db <- pg_connect()

for (file_key in names(files)) {
  
  file_name <- files[[file_key]]
  
  source_file <- file.path(source_dir, file_name)
  dest_file <- file.path(dest_dir, file_name)
  
  system(paste("cp", source_file, dest_file))
  
  if (file.exists(dest_file)) {
    status <- 'done'
  } else {
    status <- 'error'
  }
  
  query <- paste0("UPDATE tasks SET status = '", status, "' WHERE task_name = 'fp_", file_key, "';")
  DBI::dbSendQuery(db, query)
}

DBI::dbDisconnect(db)